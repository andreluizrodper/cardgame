import{_ as T,a as ae,L as V}from"./loading-CUEBrxO7.js";import{E as I,_ as w,f as $,r as c,o as n,c as i,a as t,b as l,t as m,w as y,h as p,F as b,e as h,m as M,B as D,M as U,d as g,N as j,O as W,P as N,u as x,Q as se,S as ne,T as oe,V as A,Z as le,Y as ce,W as G,$ as O,a0 as re,a1 as ie,a2 as de,a3 as ue,I as he,a4 as q,H as pe,i as me,y as _e,n as fe,g as ye}from"./index-zeHrmG7h.js";import{u as S}from"./match-B4Djmto_.js";import{g as ge}from"./deck-CUCn8pJl.js";import{H}from"./heart-CCxernIS.js";import{S as R,G as P,C as F,a as E}from"./sword-Cnc4GbwN.js";/**
 * @license lucide-vue-next v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=I("RefreshCcwIcon",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]);/**
 * @license lucide-vue-next v0.390.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=I("SkullIcon",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["path",{d:"M8 20v2h8v-2",key:"ded4og"}],["path",{d:"m12.5 17-.5-1-.5 1h1z",key:"3me087"}],["path",{d:"M16 20a2 2 0 0 0 1.56-3.25 8 8 0 1 0-11.12 0A2 2 0 0 0 8 20",key:"xq9p5u"}]]),be={components:{Button:$,Loading:T},props:{match:{type:Object}},methods:{quit(){S({data:{status:"forfeit"}}),this.$router.push({name:"lobby"})},copyCode(){navigator.clipboard.writeText(`http://localhost:5173/g/match/${this.match.id}`),this.$store.commit("addToast",{description:"Copied!"})}}},ve=t("img",{src:ae,class:"fixed h-[100vh] w-full object-cover object-center opacity-50"},null,-1),we={class:"min-h-[100vh] flex flex-col z-30 relative"},ke={class:"flex flex-1 items-center"},Ce={class:"flex flex-col gap-8 w-full justify-center items-center"},Se={class:"flex flex-col gap-2 items-center"},je=t("p",null,"Waiting for an opponent",-1),Te={class:"flex flex-col gap-1 items-center"},$e=t("span",{class:"text-xs text-gray-700 font-bold"},"Match code:",-1),Be={class:"p-4 flex justify-center"};function ze(s,a,e,d,r,o){const u=c("Loading"),_=c("Button");return n(),i(b,null,[ve,t("div",we,[t("div",ke,[t("div",Ce,[t("div",Se,[je,l(u)]),t("div",Te,[$e,t("div",{class:"bg-gray-50 px-2 py-1 text-sm rounded",onClick:a[0]||(a[0]=(...f)=>o.copyCode&&o.copyCode(...f))},m(e.match.id),1)])])]),t("div",Be,[l(_,{onClick:o.quit,variant:"outline"},{default:y(()=>[p("Quit")]),_:1},8,["onClick"])])])],64)}const Me=w(be,[["render",ze]]),De="/assets/select-deck-pzwOqqRm.jpg",Le={props:{match:{type:Object},player:{type:Object},opponent:{type:Object}},components:{Loading:T,Layers3:V},data(){return{decks:null}},mounted(){this.getDecks()},methods:{async getDecks(){this.decks=await ge(),this.decks.length===1&&this.toggleDeck(this.decks[0])},toggleDeck(s){const a=this.match.data();this.player.status="ready",this.player.deck=this.sortDeck(s.data().cards),a.players=[this.player,this.opponent],S({id:this.$route.params.id,data:a})},sortDeck(s){return s.map(a=>({value:a,sort:Math.random()})).sort((a,e)=>a.sort-e.sort).map(({value:a})=>a)}}},qe=t("img",{src:De,class:"object-cover object-center fixed h-[100vh] w-[100vw] opacity-40"},null,-1),Oe={key:0,class:"flex min-h-[100vh] items-center w-full flex-col justify-center relative z-40"},He={class:"bg-white rounded shadow-md p-6 flex flex-col gap-8"},Pe=t("p",{class:"text-xl font-bold text-center"},"Select your deck",-1),Ve={key:0,class:"flex justify-center py-6"},We={class:"flex justify-center gap-4"},Ne=["onClick"],Ae={class:"text-xl"},Ge={class:"text-based flex gap-2 items-center"};function Ie(s,a,e,d,r,o){const u=c("Loading"),_=c("Layers3");return n(),i(b,null,[qe,r.decks?(n(),i("div",Oe,[t("div",He,[Pe,r.decks?h("",!0):(n(),i("div",Ve,[l(u)])),t("div",We,[(n(!0),i(b,null,M(r.decks,f=>(n(),i("button",{key:f.id,onClick:k=>o.toggleDeck(f),class:"border rounded py-2 flex justify-center items-center text-center bg-gray-50 w-44 flex-col gap-4 hover:shadow-md"},[t("span",Ae,m(f.data().name),1),t("span",Ge,[l(_,{size:"16"}),p(m(f.data().cards.length),1)])],8,Ne))),128))])])])):h("",!0)],64)}const Ue=w(Le,[["render",Ie]]),Re="/assets/waiting-Dr02D2KF.jpg",Fe=t("img",{src:Re,class:"object-cover object-center fixed h-[100vh] w-[100vw]"},null,-1),Ee={class:"flex min-h-[100vh] items-center w-full flex-col justify-center relative z-40"},Qe={class:"bg-white rounded shadow-md p-6 flex flex-col gap-2 items-center"},Ze=t("p",{class:"text-base text-center"},"Waiting for another player",-1),Ke={__name:"waiting-player",setup(s){return(a,e)=>(n(),i(b,null,[Fe,t("div",Ee,[t("div",Qe,[l(T),Ze])])],64))}},Ye={components:{Heart:H,Sword:R,Gem:P,Button:$},props:{card:{type:Object},isTurn:{type:Boolean},expanded:{type:Boolean}},emits:["toggleMana"],methods:{activateCard(){this.isTurn&&(this.card.turnActive||this.card.manaValue&&this.$emit("toggleMana",this.card))}}},Je={class:"relative"},Xe=["src"],et={class:"absolute top-2 right-2 border rounded bg-white px-1 text-xs shadow-sm"},tt={class:"text-base flex-1 text-xs text-left px-2 py-2"},at={class:"p-2 pb-1 flex flex-col w-full"},st={key:0,class:"flex justify-between w-full"},nt={class:"flex gap-2"},ot={class:"flex gap-2 items-center"},lt={class:"flex gap-2 items-center"},ct={class:"flex gap-2 items-center"},rt={key:1,class:"flex justify-between w-full"},it={class:"flex gap-2 items-center"};function dt(s,a,e,d,r,o){const u=c("Sword"),_=c("Heart"),f=c("Gem");return n(),i("div",{onClick:a[0]||(a[0]=(...k)=>o.activateCard&&o.activateCard(...k)),class:D(["border rounded border-white min-w-36 max-w-36 flex flex-col bg-white drop-shadow overflow-hidden",[e.card.turnActive?"rotate-90 mx-10":"",e.card.manaNeeded&&e.card.turnCount===0?"opacity-40":""].join(" ")])},[t("div",Je,[t("img",{src:e.card.artwork,class:"w-36"},null,8,Xe),t("div",et,m(e.card.manaType??e.card.type),1)]),t("div",tt,m(e.card.name),1),t("div",at,[e.card.manaNeeded?(n(),i("div",st,[t("div",nt,[t("div",ot,[l(u,{size:"16"}),p(" "+m(e.card.attack),1)]),t("div",lt,[l(_,{size:"16"}),p(" "+m(e.card.health??e.card.defense),1)])]),t("div",ct,[l(f,{size:"16"}),p(" "+m(e.card.manaNeeded),1)])])):h("",!0),e.card.manaValue?(n(),i("div",rt,[t("div",it,[l(f,{size:"16"}),p(" "+m(e.card.manaValue),1)])])):h("",!0)])],2)}const Z=w(Ye,[["render",dt]]),ut={components:{Card:Z,Heart:H,ChevronDown:F,ChevronUp:E,Layers3:V,Gem:P},props:{opponent:{type:Object}},computed:{cards(){return this.opponent.table}},data(){return{expanded:!1}}},ht={class:"absolute z-30 left-0 right-0 top-0 flex"},pt={class:"flex-1 flex items-end"},mt={class:"flex mb-8 w-full justify-center"},_t={class:"px-1 scale-75 -mx-32 flex max-h-96 justify-center items-end flex-wrap"},ft={class:"text-sm top-0 z-80 right-0 bg-stone-600 text-stone-200 p-2 rounded shadow-md flex flex-col items-end gap-1 shadow-lg"},yt={class:"flex gap-4"},gt={class:"flex gap-1 items-center"},xt={class:"flex gap-1 items-center"};function bt(s,a,e,d,r,o){const u=c("Card"),_=c("Gem"),f=c("Heart"),k=c("Layers3");return n(),i("div",ht,[t("div",pt,[t("div",mt,[t("div",_t,[(n(!0),i(b,null,M(o.cards,(C,B)=>(n(),i("div",{key:B,class:"mx-1 drop-shadow flex justify-center my-1 min-h-36"},[l(u,{card:C},null,8,["card"])]))),128))])])]),t("div",null,[t("div",ft,[t("div",null,m(e.opponent.data.name),1),t("div",yt,[t("span",{class:D(["flex gap-1 items-center",!e.opponent.mana||e.opponent.mana<=0?"opacity-40":""])},[l(_,{size:"16"}),p(" "+m(e.opponent.mana),1)],2),t("span",gt,[l(f,{size:"16"}),p(" "+m(e.opponent.health),1)]),t("span",xt,[l(k,{size:"16"}),p(" "+m(e.opponent.deck.length),1)])])])])])}const vt=w(ut,[["render",bt]]),wt={__name:"Sheet",props:{open:{type:Boolean,required:!1},defaultOpen:{type:Boolean,required:!1},modal:{type:Boolean,required:!1}},emits:["update:open"],setup(s,{emit:a}){const r=U(s,a);return(o,u)=>(n(),g(x(se),W(N(x(r))),{default:y(()=>[j(o.$slots,"default")]),_:3},16))}},kt={__name:"SheetTrigger",props:{asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},setup(s){const a=s;return(e,d)=>(n(),g(x(ne),W(N(a)),{default:y(()=>[j(e.$slots,"default")]),_:3},16))}},Ct={__name:"SheetClose",props:{asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},setup(s){const a=s;return(e,d)=>(n(),g(x(oe),W(N(a)),{default:y(()=>[j(e.$slots,"default")]),_:3},16))}},St=Object.assign({inheritAttrs:!1},{__name:"SheetContent",props:{class:{type:null,required:!1},side:{type:null,required:!1},forceMount:{type:Boolean,required:!1},trapFocus:{type:Boolean,required:!1},disableOutsidePointerEvents:{type:Boolean,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},emits:["escapeKeyDown","pointerDownOutside","focusOutside","interactOutside","openAutoFocus","closeAutoFocus"],setup(s,{emit:a}){const e=s,d=a,r=A(()=>{const{class:u,side:_,...f}=e;return f}),o=U(r,d);return(u,_)=>(n(),g(x(re),null,{default:y(()=>[l(x(le),{class:"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0"}),l(x(ce),G({class:x(O)(x(Bt)({side:s.side}),e.class)},{...x(o),...u.$attrs}),{default:y(()=>[j(u.$slots,"default")]),_:3},16,["class"])]),_:3}))}}),jt={__name:"SheetHeader",props:{class:{type:null,required:!1}},setup(s){const a=s;return(e,d)=>(n(),i("div",{class:D(x(O)("flex flex-col gap-y-2 text-center sm:text-left",a.class))},[j(e.$slots,"default")],2))}},Tt={__name:"SheetTitle",props:{asChild:{type:Boolean,required:!1},as:{type:null,required:!1},class:{type:null,required:!1}},setup(s){const a=s,e=A(()=>{const{class:d,...r}=a;return r});return(d,r)=>(n(),g(x(ie),G({class:x(O)("text-lg font-semibold text-foreground",a.class)},e.value),{default:y(()=>[j(d.$slots,"default")]),_:3},16,["class"]))}},$t={__name:"SheetDescription",props:{asChild:{type:Boolean,required:!1},as:{type:null,required:!1},class:{type:null,required:!1}},setup(s){const a=s,e=A(()=>{const{class:d,...r}=a;return r});return(d,r)=>(n(),g(x(de),G({class:x(O)("text-sm text-muted-foreground",a.class)},e.value),{default:y(()=>[j(d.$slots,"default")]),_:3},16,["class"]))}},Bt=ue("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-md",right:"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-md"}},defaultVariants:{side:"right"}}),zt={components:{Heart:H,Sword:R,Gem:P,Skull:Q,Button:$},props:{isTurn:{type:Boolean},mana:{type:Number},expandedHand:{type:Boolean},card:{type:Object}},emits:["toggleCardTable","toggleCardCemetary"],methods:{toggleCardTable(){this.isTurn&&(!this.card.manaValue&&this.mana<this.card.manaNeeded||(this.card.turnCount=0,this.$emit("toggleCardTable",this.card)))},goToCemetary(){this.$emit("toggleCardCemetary",this.card)}}},Mt={class:"relative min-w-48 max-w-48 flex -ml-32 group-hover:mr-2 group-hover:ml-0 duration-300 hover:-translate-y-5"},Dt={class:"relative"},Lt=["src"],qt={class:"absolute top-2 right-2 border rounded bg-white px-1 text-xs shadow-sm"},Ot={class:"text-base flex-1 text-left px-2 py-2"},Ht={class:"p-2 pb-1 flex flex-col w-full"},Pt={key:0,class:"flex justify-between w-full"},Vt={class:"flex gap-2"},Wt={class:"flex gap-2 items-center"},Nt={class:"flex gap-2 items-center"},At={class:"flex gap-2 items-center"},Gt={key:1,class:"flex justify-between w-full"},It={class:"flex gap-2 items-center"};function Ut(s,a,e,d,r,o){const u=c("Sword"),_=c("Heart"),f=c("Gem"),k=c("Skull");return n(),i("div",Mt,[t("div",{onClick:a[0]||(a[0]=(...C)=>o.toggleCardTable&&o.toggleCardTable(...C)),class:"border border-b-0 rounded-t group-hover:rounded-b border-white min-w-48 max-w-48 flex flex-col bg-white drop-shadow overflow-hidden"},[t("div",Dt,[t("img",{src:e.card.artwork},null,8,Lt),t("div",qt,m(e.card.manaType??e.card.type),1)]),t("div",Ot,m(e.card.name),1),t("div",Ht,[e.card.manaNeeded?(n(),i("div",Pt,[t("div",Vt,[t("div",Wt,[l(u,{size:"16"}),p(" "+m(e.card.attack),1)]),t("div",Nt,[l(_,{size:"16"}),p(" "+m(e.card.defense),1)])]),t("div",At,[l(f,{size:"16"}),p(" "+m(e.card.manaNeeded),1)])])):h("",!0),e.card.manaValue?(n(),i("div",Gt,[t("div",It,[l(f,{size:"16"}),p(" "+m(e.card.manaValue),1)])])):h("",!0)])]),t("button",{onClick:a[1]||(a[1]=(...C)=>o.goToCemetary&&o.goToCemetary(...C)),size:"sm",class:"absolute top-2 left-2 px-2 py-1 rounded border bg-white"},[l(k,{size:"16"})])])}const Rt=w(zt,[["render",Ut]]),Ft={components:{Input:he,Sheet:wt,SheetClose:Ct,SheetContent:St,SheetDescription:$t,SheetHeader:jt,SheetTitle:Tt,SheetTrigger:kt,Button:$,Card:Z,CardHand:Rt,Gem:P,ChevronDown:F,Skull:Q,ChevronUp:E,Heart:H,Layers3:V,RefreshCcw:xe},props:{isSpectator:{type:Boolean},match:{type:Object},player:{type:Object},opponent:{type:Object}},computed:{drawAvailable(){return this.amountMana+this.amountSpell<=8&&this.amountMana+this.amountSpell>0},spellCards(){return this.player.deck.filter(s=>s.manaNeeded)},spellCardsCount(){return this.spellCards.length},manaCards(){return this.player.deck.filter(s=>s.manaValue)},manaCardsCount(){return this.manaCards.length},cards(){return this.player.table},tableSpellCards(){return this.player.table.filter(s=>s.manaNeeded)}},data(){return{cemetarySheet:!1,expandedHand:!1,expanded:!0,amountMana:null,amountSpell:null}},methods:{endTurn(){var s;this.player.turn=!1,this.player.hasDrawn=!1,this.opponent.mana=0,this.opponent.turn=!0,(s=this.opponent.table)==null||s.map(a=>(a.turnCount+=1,a.turnActive=!1,a)),this.match.turn+=1,this.doUpdateMatch()},toggleMana(s){s.turnActive=!0;const a=this.player.mana??0;this.player.mana=a+parseInt(s.manaValue);const e=this.match.data();e.players=[this.player,this.opponent],S({id:this.$route.params.id,data:e})},toggleCemetarySheet(){this.cemetarySheet=!1},toggleCardCemetary(s){const a=this.player.cemetary??[];a.push(s),this.player.cemetary=a;const e=this.player.hand.indexOf(s);this.player.hand.splice(e,1);const d=this.match.data();d.players=[this.player,this.opponent],S({id:this.$route.params.id,data:d})},quit(){this.player.status="lose",this.opponent.status="win";const s=this.match.data();s.status="done",s.players=[this.player,this.opponent];let a=this.player.data.lose??0;a++,q({id:this.player.id,data:{...this.player.data,lose:a},setStore:!1});let e=this.opponent.data.win??0;e++,q({id:this.opponent.id,data:{...this.opponent.data,win:e},setStore:!1}),S({id:this.$route.params.id,data:s}),this.$router.push({name:"lobby"})},doUpdateMatch(){const s=this.match.data();s.players=[this.player,this.opponent],S({id:this.$route.params.id,data:s})},drawMana(){const s=this.manaCards.splice(0,1);this.player.hand.push(...s),this.player.hasDrawn=!0,this.doUpdateMatch()},drawSpell(){const s=this.spellCards.splice(0,1);this.player.hand.push(...s),this.player.hasDrawn=!0,this.doUpdateMatch()},firstDraw(){const s=this.manaCards.splice(0,this.amountMana),a=this.spellCards.splice(0,this.amountSpell);this.player.hand=[...s,...a],this.player.hasDrawn=!0,this.doUpdateMatch()},toggleCardTable(s){const a=this.player.table??[],e=this.player.hand??[],d=e.indexOf(s);e.splice(d,1),a.push(s),this.player.table=a,this.player.hand=e,s.manaNeeded&&(this.player.mana=this.player.mana-s.manaNeeded),this.doUpdateMatch()}}},Et={class:"absolute z-40 left-0 right-0 bottom-0 flex"},Qt={class:"text-sm w-56 left-0 flex flex-col gap-2"},Zt={class:"mx-2 relative z-30"},Kt={class:"flex flex-col gap-2 mx-2"},Yt={class:"flex justify-between text-stone-200 items-center"},Jt=t("p",{class:"text-sm"},"Spell deck",-1),Xt={class:"flex gap-2 items-center"},ea={class:"w-50 h-32 bg-stone-400 bg-cover rounded flex items-start pl-3 justify-end pb-2 flex-col",style:{backgroundImage:"url(/assets/deck/back.png)"}},ta={key:0,class:""},aa={key:1,class:"flex gap-2 justify-end px-2 w-full"},sa={class:"flex flex-col gap-2 mx-2"},na={class:"flex justify-between text-stone-200 items-center"},oa=t("p",{class:"text-sm"},"Mana deck",-1),la={class:"flex gap-2 items-center"},ca={class:"w-50 h-32 bg-stone-400 bg-cover rounded flex items-start pl-3 justify-end pb-2 flex-col",style:{backgroundImage:"url(/assets/deck/back.png)"}},ra={key:0,class:""},ia={key:1,class:"flex gap-2 justify-end px-2 w-full"},da={key:0},ua={key:0,class:"text-stone-200 px-2 text-xs flex gap-2 items-center"},ha={class:"bg-stone-600 text-stone-200 p-2 rounded shadow-md flex flex-col items-start gap-1"},pa={class:"flex gap-4"},ma={class:"flex gap-1 items-center"},_a={class:"flex gap-1 items-center"},fa={class:"absolute -top-1 -right-2 px-2 rounded-full text-xs bg-red-300 text-white"},ya={class:"flex-1 flex items-end"},ga={class:"flex mb-8 w-full justify-center"},xa={class:"px-1 scale-75 -mx-32 flex max-h-96 justify-center items-end flex-wrap"},ba={key:0,class:"flex group justify-center absolute h-16 overflow-hidden hover:h-auto hover:overflow-auto bottom-0 left-0 right-0 z-30 left-[300px] hover:ml-0 duration-300 hover:bottom-2 pt-6"},va={class:"grid gap-2 grid-cols-2 overflow-y-auto"};function wa(s,a,e,d,r,o){const u=c("Button"),_=c("Layers3"),f=c("Input"),k=c("Gem"),C=c("Heart"),B=c("Skull"),L=c("Card"),K=c("CardHand"),Y=c("SheetTitle"),J=c("SheetDescription"),X=c("SheetHeader"),ee=c("SheetContent"),te=c("Sheet");return n(),i(b,null,[t("div",Et,[t("div",Qt,[t("div",Zt,[l(u,{onClick:o.endTurn,disabled:!e.player.turn,variant:"outline"},{default:y(()=>[p("End my turn")]),_:1},8,["onClick","disabled"])]),t("div",Kt,[t("div",Yt,[Jt,t("p",Xt,[l(_,{size:"16"}),p(" "+m(o.spellCardsCount),1)])]),t("div",ea,[e.player.hand?(n(),i("div",ta,[l(u,{onClick:o.drawSpell,disabled:!e.player.hasDrawn},{default:y(()=>[p("Draw")]),_:1},8,["onClick","disabled"])])):h("",!0),e.player.hand?h("",!0):(n(),i("div",aa,[l(f,{class:"w-16",modelValue:r.amountSpell,"onUpdate:modelValue":a[0]||(a[0]=v=>r.amountSpell=v),max:8-r.amountMana,min:0,type:"number"},null,8,["modelValue","max"])]))])]),t("div",sa,[t("div",na,[oa,t("p",la,[l(_,{size:"16"}),p(" "+m(o.manaCardsCount),1)])]),t("div",ca,[e.player.hand?(n(),i("div",ra,[l(u,{onClick:o.drawMana,disabled:!e.player.hasDrawn},{default:y(()=>[p("Draw")]),_:1},8,["onClick","disabled"])])):h("",!0),e.player.hand?h("",!0):(n(),i("div",ia,[l(f,{class:"w-16",modelValue:r.amountMana,"onUpdate:modelValue":a[1]||(a[1]=v=>r.amountMana=v),max:8-r.amountSpell,min:0,type:"number"},null,8,["modelValue","max"])]))])]),e.player.turn?(n(),i("div",da,[e.player.hand?h("",!0):(n(),i("div",ua,[p(" It's your first draw, select up to 8 cards to draw "),l(u,{size:"xs",disabled:!o.drawAvailable,onClick:o.firstDraw},{default:y(()=>[p("Draw")]),_:1},8,["disabled","onClick"])]))])):h("",!0),t("div",ha,[t("div",null,m(e.player.data.name),1),t("div",pa,[t("span",{class:D(["flex gap-1 items-center",!e.player.mana||e.player.mana<=0?"opacity-40":""])},[l(k,{size:"16"}),p(" "+m(e.player.mana),1)],2),t("span",ma,[l(C,{size:"16"}),p(" "+m(e.player.health),1)]),t("span",_a,[l(_,{size:"16"}),p(" "+m(e.player.deck.length),1)]),e.player.cemetary?(n(),i("button",{key:0,class:"border bg-gray-50 rounded flex gap-2 items-center px-2 py-1 relative",onClick:a[2]||(a[2]=v=>r.cemetarySheet=!0)},[t("span",fa,m(e.player.cemetary.length),1),l(B,{size:"16"})])):h("",!0)]),e.isSpectator?h("",!0):(n(),i("button",{key:0,class:"px-2 rounded bg-stone-400 text-stone-700 hover:bg-stone-900 hover:text-red-300",onClick:a[3]||(a[3]=(...v)=>o.quit&&o.quit(...v))}," Quit match "))])]),t("div",ya,[t("div",ga,[t("div",xa,[(n(!0),i(b,null,M(o.cards,(v,z)=>(n(),i("div",{key:z,class:"mx-1 drop-shadow flex justify-center my-1 min-h-36"},[l(L,{card:v,isTurn:e.player.turn,onToggleMana:o.toggleMana},null,8,["card","isTurn","onToggleMana"])]))),128))])]),e.isSpectator?h("",!0):(n(),i("div",ba,[(n(!0),i(b,null,M(e.player.hand,(v,z)=>(n(),g(K,{key:z,card:v,mana:e.player.mana,isTurn:e.player.turn,onToggleCardTable:o.toggleCardTable,onToggleCardCemetary:o.toggleCardCemetary},null,8,["card","mana","isTurn","onToggleCardTable","onToggleCardCemetary"]))),128))]))])]),l(te,{class:"max-w-md",open:r.cemetarySheet,"onUpdate:open":o.toggleCemetarySheet},{default:y(()=>[l(ee,null,{default:y(()=>[l(X,null,{default:y(()=>[l(Y,null,{default:y(()=>[p(" Cemetary ")]),_:1}),l(J)]),_:1}),t("div",va,[(n(!0),i(b,null,M(e.player.cemetary,(v,z)=>(n(),g(L,{key:z,card:v,onToggleCard:s.toggleCard},null,8,["card","onToggleCard"]))),128))])]),_:1})]),_:1},8,["open","onUpdate:open"])],64)}const ka=w(Ft,[["render",wa]]),Ca={components:{Loading:T,OpponentTable:vt,PlayerTable:ka},props:{match:{type:Object},player:{type:Object},opponent:{type:Object},isLoading:{type:Boolean},isSpectator:{type:Boolean}}},Sa={key:0,class:"flex items-center justify-center min-h-[100vh]"};function ja(s,a,e,d,r,o){const u=c("Loading"),_=c("OpponentTable"),f=c("PlayerTable");return n(),i(b,null,[e.isLoading?(n(),i("div",Sa,[l(u)])):h("",!0),e.isLoading?h("",!0):(n(),i("div",{key:1,class:D(["min-h-[100vh] flex flex-col w-full",e.isSpectator?"pointer-events-none":""]),style:{"background-image":"url(/assets/bg/wood.jpg)"}},[l(_,{opponent:e.opponent},null,8,["opponent"]),l(f,{isSpectator:e.isSpectator,player:e.player,match:e.match,opponent:e.opponent},null,8,["isSpectator","player","match","opponent"])],2))],64)}const Ta=w(Ca,[["render",ja]]),$a="/assets/win-Cb0Zhqy4.jpg",Ba={components:{Button:$}},za=t("img",{src:$a,class:"object-cover object-center fixed h-[100vh] w-[100vw]"},null,-1),Ma={class:"relative z-30 min-h-[100vh] flex flex-col"},Da=t("div",{class:"flex flex-1 items-center"},null,-1),La={class:"p-4 flex justify-center"};function qa(s,a,e,d,r,o){const u=c("router-link"),_=c("Button");return n(),i(b,null,[za,t("div",Ma,[Da,t("div",La,[l(_,{variant:"outline"},{default:y(()=>[l(u,{to:{name:"lobby"}},{default:y(()=>[p("Back to lobby")]),_:1})]),_:1})])])],64)}const Oa=w(Ba,[["render",qa]]),Ha="/assets/defeat-CeR2OGbT.jpg",Pa={components:{Button:$}},Va=t("img",{src:Ha,class:"object-cover object-center fixed h-[100vh] w-[100vw]"},null,-1),Wa={class:"relative z-30 min-h-[100vh] flex flex-col"},Na=t("div",{class:"flex flex-1 items-center"},null,-1),Aa={class:"p-4 flex justify-center"};function Ga(s,a,e,d,r,o){const u=c("router-link"),_=c("Button");return n(),i(b,null,[Va,t("div",Wa,[Na,t("div",Aa,[l(_,{variant:"outline"},{default:y(()=>[l(u,{to:{name:"lobby"}},{default:y(()=>[p("Back to lobby")]),_:1})]),_:1})])])],64)}const Ia=w(Pa,[["render",Ga]]),Ua={props:{isSpectator:{type:Boolean},match:{type:Object},player:{type:Object},opponent:{type:Object}},components:{Home:pe,Loading:T,SelectingDeck:Ue,WaitingPlayer:Ke,Match:Ta,Lose:Ia,Win:Oa},computed:{account(){return this.$store.state.account},isSelectingDeck(){return this.player.status==="selecting-deck"},isWaiting(){return this.player.status==="ready"&&this.opponent.status==="selecting-deck"},isReady(){return this.player.status==="ready"&&this.opponent.status==="ready"},hasPlayerWon(){return this.player.status==="win"},hasPlayerLose(){return this.player.status==="lose"}}};function Ra(s,a,e,d,r,o){const u=c("Home"),_=c("router-link"),f=c("SelectingDeck"),k=c("WaitingPlayer"),C=c("Match"),B=c("Win"),L=c("Lose");return n(),i(b,null,[e.isSpectator?(n(),g(_,{key:0,to:{name:"lobby"},class:"absolute top-2 left-2 border border-gray-500 hover:bg-gray-800 rounded bg-gray-700 text-white p-2 text-sm"},{default:y(()=>[l(u,{size:"16"})]),_:1})):h("",!0),o.isSelectingDeck?(n(),g(f,{key:1,match:e.match,player:e.player,opponent:e.opponent},null,8,["match","player","opponent"])):h("",!0),o.isWaiting?(n(),g(k,{key:2})):h("",!0),o.isReady?(n(),g(C,{key:3,match:e.match,player:e.player,opponent:e.opponent,isSpectator:e.isSpectator},null,8,["match","player","opponent","isSpectator"])):h("",!0),o.hasPlayerWon?(n(),g(B,{key:4})):h("",!0),o.hasPlayerLose?(n(),g(L,{key:5})):h("",!0)],64)}const Fa=w(Ua,[["render",Ra]]),Ea={components:{Loading:T,Waiting:Me,TableTop:Fa},computed:{account(){return this.$store.state.account},player(){return this.match.data().shared_with.includes(this.account.id)?this.match.data().players.find(s=>s.id===this.account.id):this.match.data().players[0]},opponent(){return this.match.data().shared_with.includes(this.account.id)?this.match.data().players.find(s=>s.id!==this.account.id):this.match.data().players[1]},isSpectator(){return!this.match.data().shared_with.includes(this.account.id)}},data(){return{match:null,battle:!1}},async mounted(){me(_e(fe,"match",this.$route.params.id),async s=>{if(this.match=s,this.match.data().shared_with.length===1&&!this.match.data().shared_with.includes(this.account.id)){const a=this.match.data().shared_with;a.push(this.account.id);const e=Math.floor(Math.random()*1e3+1)%2,d=await ye({id:this.match.data().created_by,setStore:!1});let r=this.account.data().matches??0;r++,q({id:this.account.id,data:{...this.account.data(),matches:r},setStore:!1});let o=d.data().matches??0;o++,q({id:this.match.data().created_by,data:{...d.data(),matches:o},setStore:!1}),S({id:this.$route.params.id,data:{shared_with:a,status:"playing",turn:1,players:[{data:this.account.data(),turn:!!e,id:this.account.id,status:"selecting-deck",health:20},{data:d.data(),turn:!e,id:this.match.data().created_by,status:"selecting-deck",health:20}]}})}})}},Qa={key:0,class:"min-h-[100vh] flex items-center justify-center"},Za={key:1},Ka={key:2};function Ya(s,a,e,d,r,o){const u=c("Loading"),_=c("Waiting"),f=c("TableTop");return n(),i(b,null,[r.match?h("",!0):(n(),i("div",Qa,[l(u)])),r.match?(n(),i("div",Za,[r.match.data().status==="waiting"?(n(),g(_,{key:0,match:r.match},null,8,["match"])):h("",!0),["playing","done"].includes(r.match.data().status)&&o.player&&o.opponent?(n(),g(f,{key:1,isSpectator:o.isSpectator,match:r.match,player:o.player,opponent:o.opponent},null,8,["isSpectator","match","player","opponent"])):h("",!0),r.match.data().status==="forfeit"?(n(),i("div",Ka," This match is not available anymore ")):h("",!0)])):h("",!0)],64)}const ns=w(Ea,[["render",Ya]]);export{ns as default};
